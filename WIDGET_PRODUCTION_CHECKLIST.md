# Widget Production Build Checklist

## âœ… Critical: Commit Widget Code to Git

**IMPORTANT:** The widget code must be committed to git before building production!

```bash
git add targets/widget/widgets.swift
git commit -m "Add LifeSet widget implementation with adaptive colors"
```

EAS Build pulls code from git, so uncommitted files won't be included in the build.

## âœ… Configuration Checklist

### 1. Widget Code (targets/widget/widgets.swift)
- âœ… Contains actual implementation (not template code)
- âœ… Has `loadWidgetData()` function
- âœ… Has `SmallWidgetView`, `MediumWidgetView`, `LargeWidgetView`
- âœ… Uses adaptive colors (`.primary`, `.secondary`)
- âœ… Reads from App Groups UserDefaults
- âœ… **COMMITTED TO GIT** âš ï¸ (Currently untracked - must commit!)

### 2. App Configuration (app.json)
- âœ… `appleTargets` configured for widget extension
- âœ… App Groups entitlements set: `group.com.lifesetwellbeing.lifeset`
- âœ… `@bacons/apple-targets` plugin in plugins array
- âœ… Widget bundle identifier: `com.lifesetwellbeing.lifeset.widget`

### 3. Data Sync Service (src/services/widget-data-sync.ts)
- âœ… Uses `ExtensionStorage` from `@bacons/apple-targets`
- âœ… Syncs to App Groups UserDefaults
- âœ… Called from `habits-screen.tsx` on load and habit completion

### 4. Widget Bundle (targets/widget/index.swift)
- âœ… Only exports the LifeSet widget (not template widgets)
- âœ… Uses `@main` attribute correctly

### 5. Apple Developer Portal
- âœ… App Group `group.com.lifesetwellbeing.lifeset` exists
- âœ… Main app ID has App Group enabled
- âœ… Widget extension App ID has App Group enabled
- âœ… Provisioning profiles will be regenerated by EAS Build

## ğŸ” Pre-Production Verification Steps

### Step 1: Commit Widget Code
```bash
# Check status
git status targets/widget/widgets.swift

# Add and commit
git add targets/widget/widgets.swift targets/widget/index.swift
git commit -m "Add LifeSet widget implementation"
```

### Step 2: Verify Widget Code Content
```bash
# Verify it has the implementation (not template)
grep -q "loadWidgetData" targets/widget/widgets.swift && echo "âœ… Has implementation" || echo "âŒ Still template"

# Verify it has adaptive colors
grep -q "\.primary" targets/widget/widgets.swift && echo "âœ… Has adaptive colors" || echo "âŒ Missing adaptive colors"
```

### Step 3: Verify Git Status
```bash
# Make sure file is tracked
git ls-files targets/widget/widgets.swift

# Should output: targets/widget/widgets.swift
```

### Step 4: Build Production
```bash
eas build --profile production --platform ios
```

## ğŸ“‹ What Happens During Production Build

1. **EAS Build pulls code from git** (your latest commit)
2. **Runs `npx expo prebuild`** which:
   - Processes `app.json` configuration
   - Uses `@bacons/apple-targets` plugin to set up widget extension
   - Copies files from `targets/widget/` to iOS project
3. **Compiles widget extension** with your Swift code
4. **Links App Groups** between main app and widget extension
5. **Creates production build** with widget included

## âš ï¸ Important Notes

- **Development and Production builds use the same source code** from git
- If development build works, production build will work (assuming code is committed)
- The widget code is source code (not generated), so it's the same for both builds
- App Groups must be configured in Apple Developer Portal (EAS Build handles provisioning profiles)

## ğŸ¯ Final Checklist Before Production Build

- [ ] Widget code is committed to git
- [ ] Development build tested and working
- [ ] Widget displays actual data (not template data)
- [ ] Widget adapts to light/dark mode correctly
- [ ] App Groups configured in Apple Developer Portal
- [ ] Ready to build production



